// Generated by CoffeeScript 1.3.3
var YOBAS, moveYobas;

YOBAS = [];

moveYobas = function() {
  var M, N, R, X0, Y0, a, allYobasStopped, bumpedYoba, canvasElement, ctx, dFi, dS, f, fi, i, m1, m2, oL, oR, pi, scriptIntervalID, v1, v11, v2, v21, y, yL, yR, yb, yobaIndex, _i, _j, _k, _len, _len1, _len2;
  pi = Math.PI;
  canvasElement = Yoba.canvasElement;
  ctx = Yoba.ctx;
  scriptIntervalID = Yoba.scriptIntervalID;
  ctx.clearRect(0, 0, canvasElement.width, canvasElement.height);
  for (yobaIndex = _i = 0, _len = YOBAS.length; _i < _len; yobaIndex = ++_i) {
    y = YOBAS[yobaIndex];
    X0 = y.position - y.radius;
    Y0 = canvasElement.height - 2 * y.radius;
    R = y.radius;
    dS = y.speed;
    M = y.mass;
    if (y.position + R + dS >= canvasElement.width && dS > 0) {
      dS = -Math.abs(dS);
    } else if (y.position - R + dS <= 0 && dS < 0) {
      dS = +Math.abs(dS);
    }
    bumpedYoba = null;
    for (i = _j = 0, _len1 = YOBAS.length; _j < _len1; i = ++_j) {
      yb = YOBAS[i];
      if (yobaIndex !== i) {
        oR = yb.position + yb.radius + yb.speed;
        oL = yb.position - yb.radius + yb.speed;
        yR = y.position + R + dS;
        yL = y.position - R + dS;
        if ((oL <= yR && yR <= oR) || (oL <= yL && yL <= oR)) {
          bumpedYoba = yb;
        }
      }
    }
    if (bumpedYoba) {
      m1 = y.mass;
      m2 = bumpedYoba.mass;
      v1 = y.speed;
      v2 = bumpedYoba.speed;
      v11 = ((m1 - m2) * v1 + 2 * m2 * v2) / (m1 + m2);
      v21 = (2 * m1 * v1 + (m2 - m1) * v2) / (m1 + m2);
      dS = v11;
      bumpedYoba.speed = v21;
    }
    f = 0.3;
    N = 9.8 * M;
    a = (N * (f / R)) / R;
    if (dS > 0) {
      dS -= a;
    } else {
      dS -= -a;
    }
    dFi = 2 * pi + (Math.round(dS) / R);
    fi = y.angle + dFi;
    ctx.save();
    ctx.translate(X0 + Math.round(dS), Y0);
    ctx.translate(R, R);
    ctx.rotate(fi);
    ctx.drawImage(y.src, -R, -R, 2 * R, 2 * R);
    ctx.restore();
    y.angle = fi % (4 * pi);
    y.position += Math.round(dS);
    y.speed = dS;
  }
  allYobasStopped = true;
  for (_k = 0, _len2 = YOBAS.length; _k < _len2; _k++) {
    yb = YOBAS[_k];
    if (Math.floor(Math.abs(yb.speed)) !== 0) {
      allYobasStopped = false;
      break;
    }
  }
  if (allYobasStopped) {
    clearInterval(scriptIntervalID);
    return setTimeout(function() {
      ctx.save();
      ctx.font = 'italic 40pt Calibri';
      ctx.shadowColor = 'orange';
      ctx.shadowOffsetX = 3;
      ctx.shadowOffsetY = 3;
      ctx.fillText('SASAI LOLKA', Math.floor(canvasElement.width * 0.30), 100);
      ctx.font = 'italic 10pt Calibri';
      ctx.shadowColor = 'red';
      ctx.shadowOffsetX = 1;
      ctx.shadowOffsetY = 1;
      ctx.fillText('Click to replay', Math.floor(canvasElement.width * 0.50), 130);
      return ctx.restore();
    }, 1000);
  }
};
